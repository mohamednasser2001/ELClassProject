@model Models.Course
@{
    Layout = "_StudentLayout";
}

<div class="content-wrapper course-details-page">
    <div class="header-section">
        <h2 class="course-title">@Model.TitleEn</h2>
        <p class="course-subtitle">Lectures and course learning materials</p>
    </div>

    <div class="lectures-container">
        @if (Model.Lessons != null && Model.Lessons.Any())
        {
            int count = 1;
            foreach (var lesson in Model.Lessons)
            {
                <div class="lecture-item">
                    <div class="lecture-header" onclick="toggleLecture(this)">
                        <div class="lecture-title">
                            <span class="lecture-number">@count</span>
                            <h3 class="lecture-name">
                                Lecture @count: @lesson.Title
                            </h3>
                        </div>

                        <!-- Arrow goes to LessonDetails (and does NOT toggle) -->
                        <a asp-area="StudentArea"
                           asp-controller="Lectures"
                           asp-action="LessonDetails"
                           asp-route-id="@lesson.Id"
                           class="lecture-arrow"
                           onclick="event.stopPropagation();"
                           title="Open lesson details">
                            <i class="fas fa-chevron-down arrow-icon"></i>
                        </a>
                    </div>

                    <div class="lecture-content">
                        <div class="content-links">
                            @if (!string.IsNullOrEmpty(lesson.DriveLink))
                            {
                                <a href="@lesson.DriveLink"
                                   target="_blank"
                                   rel="noopener"
                                   class="content-link video">
                                    <i class="fas fa-video"></i>
                                    Watch lecture
                                </a>
                            }

                            @if (!string.IsNullOrEmpty(lesson.LecturePdfUrl))
                            {
                                <a href="@lesson.LecturePdfUrl"
                                   target="_blank"
                                   rel="noopener"
                                   class="content-link pdf">
                                    <i class="fas fa-file-pdf"></i>
                                    Lecture PDF
                                </a>
                            }

                            @if (!string.IsNullOrEmpty(lesson.AssignmentPdfUrl))
                            {
                                <a href="@lesson.AssignmentPdfUrl"
                                   target="_blank"
                                   rel="noopener"
                                   class="content-link assignment">
                                    <i class="fas fa-tasks"></i>
                                    Assignment
                                </a>
                            }
                        </div>
                    </div>
                </div>
                count++;
            }
        }
        else
        {
            <p class="text-muted">
                No lectures have been added to this course yet.
            </p>
        }
    </div>
</div>

<script>
    function toggleLecture(header) {
        const item = header.closest('.lecture-item');

        // Close any other opened lecture (optional)
        document.querySelectorAll('.lecture-item').forEach(el => {
            if (el !== item) el.classList.remove('active');
        });

        // Toggle current lecture
        item.classList.toggle('active');

        // Smooth height animation
        const content = item.querySelector('.lecture-content');
        if (item.classList.contains('active')) {
            content.style.maxHeight = content.scrollHeight + "px";
        } else {
            content.style.maxHeight = null;
        }
    }

    // Ensure all lectures start collapsed
    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll('.lecture-item .lecture-content').forEach(c => {
            c.style.maxHeight = null;
        });
    });
</script>
