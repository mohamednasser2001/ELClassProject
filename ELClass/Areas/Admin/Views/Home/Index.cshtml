@{
    var currentLang = System.Threading.Thread.CurrentThread.CurrentCulture.Name.StartsWith("ar") ? "ar" : "en";
    var isAr = currentLang == "ar";
    ViewData["Title"] = isAr ? "لوحة التحكم" : "Admin Dashboard";
}

<!-- ─── Welcome Card ───────────────────────────────────────── -->
<div class="el-welcome-card mb-4" style="direction:@(isAr ? "rtl" : "ltr")">
    <div style="position:relative;z-index:1">
        <h2 class="wc-title">
            @(isAr ? "مرحباً بك في لوحة تحكم ELClass" : "Welcome to ELClass Admin")
        </h2>
        <p class="wc-desc">
            @(isAr
                ? "قم بإدارة منصتك التعليمية بكل سهولة. تابع تقدم الطلاب، نظّم الدروس، وادعم مجتمعك التعليمي."
                : "Manage your educational platform with ease. Track student progress, organize lessons, and support your teaching community.")
        </p>
    </div>
    <i class="ti ti-shield-check wc-icon"></i>
</div>

<!-- ─── Stat Cards ────────────────────────────────────────── -->
<div class="row g-4 mb-4" style="direction:@(isAr ? "rtl" : "ltr")">
    <div class="col-xl-3 col-md-6">
        <div class="el-stat-card el-stat-blue">
            <div class="stat-icon"><i class="ti ti-users"></i></div>
            <div class="stat-number">@ViewBag.TotalStudents</div>
            <div class="stat-label">@(isAr ? "إجمالي الطلاب" : "Total Students")</div>
            <div class="stat-trend @(ViewBag.StudentsGrowth >= 0 ? "up" : "down")">
                <i class="ti ti-trending-@(ViewBag.StudentsGrowth >= 0 ? "up" : "down")"></i>
                @ViewBag.StudentsGrowth% @(isAr ? "نمو" : "growth")
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="el-stat-card el-stat-sky">
            <div class="stat-icon"><i class="ti ti-user-plus"></i></div>
            <div class="stat-number">@ViewBag.newStudents</div>
            <div class="stat-label">@(isAr ? "الطلاب الجدد (آخر 30 يوم)" : "New Students (Last 30d)")</div>
            <div class="stat-trend up">
                <i class="ti ti-calendar"></i>
                @ViewBag.NewLessonsThisWeek @(isAr ? "محاضرة جديدة هذا الأسبوع" : "new lessons this week")
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="el-stat-card el-stat-green">
            <div class="stat-icon"><i class="ti ti-school"></i></div>
            <div class="stat-number">@ViewBag.TotalSubjects</div>
            <div class="stat-label">@(isAr ? "إجمالي المواد" : "Total Subjects")</div>
            <div class="stat-trend neutral">
                <i class="ti ti-book"></i>
                @(isAr ? "عبر جميع المراحل" : "Across all grades")
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="el-stat-card el-stat-amber">
            <div class="stat-icon"><i class="fa-solid fa-chalkboard-user"></i></div>

            <div class="stat-number">@ViewBag.ActiveInstructors</div>

            <div class="stat-label">@(isAr ? "المدرسون النشطون" : "Active Instructors")</div>

            <div class="stat-trend up">
                <i class="ti ti-user-plus"></i>
                <span class="fw-bold">@ViewBag.NewInstructors</span>
                @(isAr ? "انضموا حديثاً" : "joined recently")
            </div>
        </div>
    </div>

</div>

<!-- ─── Quick Actions ─────────────────────────────────────── -->
<div class="card mb-4" style="direction:@(isAr ? "rtl" : "ltr")">
    <div class="card-body">
        <div class="el-card-header">
            <div class="ch-icon" style="background:var(--el-primary-light);color:var(--el-primary)">
                <i class="ti ti-bolt"></i>
            </div>
            <span class="ch-title">@(isAr ? "إجراءات سريعة" : "Quick Actions")</span>
        </div>
        <div class="row g-3">
            <div class="col-xl-3 col-md-6">
                <a href="/Admin/Student" class="el-quick-action">
                    <div class="qa-icon qa-blue"><i class="ti ti-users"></i></div>
                    <div class="qa-label">@(isAr ? "إدارة الطلاب" : "Manage Students")</div>
                    <div class="qa-sublabel">@(isAr ? "عرض وتعديل ملفات الطلاب" : "View and edit student profiles")</div>
                </a>
            </div>
            <div class="col-xl-3 col-md-6">
                <a href="/Admin/Course" class="el-quick-action">
                    <div class="qa-icon qa-sky"><i class="ti ti-book"></i></div>
                    <div class="qa-label">@(isAr ? "إدارة الدروس" : "Manage Lessons")</div>
                    <div class="qa-sublabel">@(isAr ? "إنشاء وتنظيم المحتوى" : "Create and organize content")</div>
                </a>
            </div>
            <div class="col-xl-3 col-md-6">
                <a href="#" class="el-quick-action">
                    <div class="qa-icon qa-green"><i class="ti ti-school"></i></div>
                    <div class="qa-label">@(isAr ? "إدارة المواد" : "Manage Subjects")</div>
                    <div class="qa-sublabel">@(isAr ? "تنظيم أقسام المواد" : "Organize subject categories")</div>
                </a>
            </div>
            <div class="col-xl-3 col-md-6">
                <a href="/Admin/Instructor" class="el-quick-action">
                    <div class="qa-icon qa-amber"><i class="fa-regular fa-user"></i></div>
                    <div class="qa-label">@(isAr ? "إدارة المدرسين" : "Manage Instructors")</div>
                    <div class="qa-sublabel">@(isAr ? "إدارة طاقم التدريس" : "Manage teaching staff")</div>
                </a>
            </div>
        </div>
    </div>
</div>

<!-- ─── Activity + Top Subjects ──────────────────────────── -->
<div class="row g-4 mb-4" style="direction:@(isAr ? "rtl" : "ltr")">

    <div class="col-xl-8">
        <div class="card h-100">
            <div class="card-body">
                <div class="el-card-header">
                    <div class="ch-icon" style="background:var(--el-primary-light);color:var(--el-primary)">
                        <i class="ti ti-activity"></i>
                    </div>
                    <span class="ch-title">@(isAr ? "نظرة عامة على نشاط المنصة" : "Platform Activity Overview")</span>
                </div>

                <div class="d-flex align-items-center justify-content-between mb-3">
                    <div>
                        <small style="color:var(--el-text-muted)">@(isAr ? "الطلاب الجدد هذا الشهر" : "New Students This Month")</small>
                        <h4 class="mb-0 mt-1" style="color:var(--el-primary);font-weight:800">+@ViewBag.newStudents @(isAr ? "طالب" : "Students")</h4>
                    </div>
                </div>

                <div style="background:var(--el-primary-light);border-left:3px solid var(--el-primary);padding:14px 16px;border-radius:var(--el-radius-sm);margin-bottom:16px;">
                    <div style="background:var(--el-body); border-radius:var(--el-radius); padding:15px; min-height:200px;">
                        <canvas id="enrollmentChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-4">
        <div class="card h-100">
            <div class="card-body">
                <div class="el-card-header">
                    <div class="ch-icon" style="background:var(--el-success-light);color:var(--el-success)">
                        <i class="ti ti-trending-up"></i>
                    </div>
                    <span class="ch-title">@(isAr ? "أعلى المواد أداءً" : "Top Performing Subjects")</span>
                </div>

                @if (Model != null)
                {
                    <div style="display:flex;flex-direction:column;gap:10px;">
                        @foreach (var sub in Model)
                        {
                            <div style="display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border:1px solid var(--el-border);border-radius:var(--el-radius-sm);">
                                <div>
                                    <div style="font-weight:700;font-size:14px;color:var(--el-text)">@sub.Title</div>
                                    <small class="text-muted">@sub.Count @(isAr ? "طالب" : "students")</small>
                                </div>
                                <span style="background:var(--el-success-light);color:var(--el-success-dark);font-size:12px;font-weight:700;padding:4px 10px;border-radius:999px">
                                    @sub.Rate <i class="ti ti-arrow-up"></i>
                                </span>
                            </div>
                        }
                    </div>
                }
            </div>
        </div>
    </div>

</div>

<!-- ─── Tip Card ──────────────────────────────────────────── -->
@* <div style="background:linear-gradient(to @(isAr ? "left" : "right"),var(--el-warning-light),var(--el-card));border-inline-start:4px solid var(--el-warning);border-radius:var(--el-radius);padding:20px 22px;display:flex;align-items:center;gap:16px;direction:@(isAr ? "rtl" : "ltr")">
    <div style="width:46px;height:46px;border-radius:12px;background:var(--el-warning);display:flex;align-items:center;justify-content:center;flex-shrink:0">
        <i class="ti ti-bulb" style="color:#fff;font-size:20px"></i>
    </div>
    <div>
        <div style="font-weight:700;color:#92400E;margin-bottom:4px;font-size:14px">@(isAr ? "نصيحة المنصة" : "Platform Tip")</div>
        <p style="margin:0;color:var(--el-text-muted);font-size:13px">
            @(isAr
                ? "شجع المدرسين على تقديم ملاحظات دورية للطلاب. الدراسات تظهر أن التغذية الراجعة في الوقت المناسب تحسن نتائج التعلم بنسبة تصل إلى 40%!"
                : "Encourage instructors to provide regular feedback to students. Studies show that timely feedback improves learning outcomes by up to 40%!")
        </p>
    </div>
</div> *@
@section Scripts{
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        const ctx = document.getElementById('enrollmentChart').getContext('2d');

        // جلب البيانات من السيرفر
        const labels = @Html.Raw(Json.Serialize(ViewBag.ChartLabels));
        const dataPoints = @Html.Raw(Json.Serialize(ViewBag.ChartData));

        new Chart(ctx, {
            type: 'line', // نوع الرسم (خطي)
            data: {
                labels: labels,
                datasets: [{
                    label: '@(isAr ? "الطلاب المسجلين" : "Enrolled Students")',
                    data: dataPoints,
                    borderColor: '#5e35b1', // لون الخط (بنفسجي زي التمبلت)
                    backgroundColor: 'rgba(94, 53, 177, 0.1)', // لون التظليل تحت الخط
                    fill: true,
                    tension: 0.4, // لجعل الخط منحني وانسيابي
                    borderWidth: 3,
                    pointRadius: 4,
                    pointBackgroundColor: '#5e35b1'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false } // إخفاء دليل الرسم لتوفير مساحة
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { stepSize: 1 }
                    },
                    x: {
                        grid: { display: false } // إخفاء الخطوط الرأسية لشكل أنظف
                    }
                }
            }
        });
    </script>
}