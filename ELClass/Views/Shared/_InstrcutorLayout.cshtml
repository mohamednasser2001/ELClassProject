@using DataAccess.Repositories.IRepositories
@using Microsoft.AspNetCore.Identity
@using Models
@inject UserManager<ApplicationUser> UserManager
@inject IUnitOfWork _unitOfWork
@{
    var user        = await UserManager.GetUserAsync(User);
    var userImage   = user?.Img;
    var displayName = user?.NameEN ?? user?.UserName;
    var isArabic    = System.Globalization.CultureInfo.CurrentCulture.TwoLetterISOLanguageName == "ar";
    var dir         = isArabic ? "rtl" : "ltr";
}

<!doctype html>
<html lang="@(isArabic ? "ar" : "en")" dir="@dir" style="--el-role-color:#7C3AED;--el-role-light:#F5F3FF;--el-primary-rgb:124,58,237;">
<head>
    <title>@(isArabic ? "لوحة تحكم المحاضر — ELClass" : "Instructor Dashboard — ELClass")</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui" />
    <link rel="icon" href="~/Images/Logos/logos-03.png" type="image/x-icon" />

    <!-- Cairo — Arabic + Latin -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet" />

    <!-- Icons -->
    <link rel="stylesheet" href="~/assets/fonts/phosphor/duotone/style.css" />
    <link rel="stylesheet" href="~/assets/fonts/tabler-icons.min.css" />
    <link rel="stylesheet" href="~/assets/fonts/feather.css" />
    <link rel="stylesheet" href="~/assets/fonts/material.css" />
    <link rel="stylesheet" href="~/lib/fontawesome/css/all.min.css" />

    <!-- Design system -->
    <link rel="stylesheet" href="~/css/color-tokens.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/bootstrap-overrides.css" asp-append-version="true" />

    <!-- Berry template -->
    <link rel="stylesheet" href="~/assets/css/style.css" id="main-style-link" />
    <link rel="stylesheet" href="~/assets/css/style-preset.css" />
    <link rel="stylesheet" href="~/assets/css/berry-color-overrides.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/assets/css/preset-color-overrides.css" asp-append-version="true" />

    <!-- ELClass layout override -->
    <link rel="stylesheet" href="~/css/elclass-layout.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/admin-components.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/Instructor-component.css" asp-append-version="true" />

    <!-- Instructor violet accent override -->
    <style>
        .pc-sidebar .pc-item.active > .pc-link,
        .pc-sidebar .pc-link.active,
        .pc-sidebar .pc-item.pc-trigger > .pc-link {
            background: rgba(124, 58, 237, 0.15) !important;
            color: #C4B5FD !important;
        }
        .el-quick-action:hover {
            border-color: #7C3AED !important;
            background: #F5F3FF !important;
            color: #7C3AED !important;
        }
    </style>

    <!-- Third-party -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

    @RenderSection("Styles", required: false)
</head>

<body>
    <!-- Page loader -->
    <div class="loader-bg">
        <div class="loader-track">
            <div class="loader-fill"></div>
        </div>
    </div>

    <!-- ─── Sidebar ─────────────────────────────────────── -->
    <nav class="pc-sidebar">
        <div class="navbar-wrapper">

            <!-- Logo -->
            <div class="m-header">
                <a href="/Instructor/Home/Index" class="b-brand">
                    <img src="/images/logos/logos-02.png" alt="ELClass" width="140" class="logo" />
                </a>
            </div>

            <!-- Navigation -->
            <div class="navbar-content">
                <ul class="pc-navbar">

                    @await Component.InvokeAsync("LiveMeeting")

                    <li class="pc-item pc-caption">
                        <label>@(isArabic ? "الرئيسية" : "Main")</label>
                    </li>

                    <li class="pc-item">
                        <a href="/Instructor/Home/Index" class="pc-link">
                            <span class="pc-micon"><i class="fa-jelly fa-regular fa-chart-bar"></i></span>
                            <span class="pc-mtext">@(isArabic ? "لوحة التحكم" : "Dashboard")</span>
                        </a>
                    </li>

                    <li class="pc-item pc-caption">
                        <label>@(isArabic ? "إدارة المحتوى" : "Management")</label>
                    </li>

                    <li class="pc-item">
                        <a href="/Instructor/Course/index" class="pc-link">
                            <span class="pc-micon"><i class="ti ti-book"></i></span>
                            <span class="pc-mtext">@(isArabic ? "الكورسات" : "Courses")</span>
                        </a>
                    </li>

                    <li class="pc-item">
                        <a href="/Instructor/Student/index" class="pc-link">
                            <span class="pc-micon"><i class="ti ti-users"></i></span>
                            <span class="pc-mtext">@(isArabic ? "طلابي" : "My Students")</span>
                        </a>
                    </li>

                    <li class="pc-item pc-hasmenu">
                        <a href="#!" class="pc-link">
                            <span class="pc-micon"><i class="ti ti-calendar-event"></i></span>
                            <span class="pc-mtext">@(isArabic ? "المواعيد" : "Appointments")</span>
                            <span class="pc-arrow"><i class="ti ti-chevron-right"></i></span>
                        </a>
                        <ul class="pc-submenu">
                            <li class="pc-item">
                                <a class="pc-link" href="/Instructor/appointment/index">@(isArabic ? "كل المواعيد" : "All Appointments")</a>
                            </li>
                            <li class="pc-item">
                                <a class="pc-link" href="/Instructor/appointment/create">@(isArabic ? "إضافة موعد" : "Add Appointment")</a>
                            </li>
                        </ul>
                    </li>

                </ul>
            </div>
        </div>
    </nav>

    <!-- ─── Header ──────────────────────────────────────── -->
    <header class="pc-header">
        <div class="header-wrapper">

            <!-- Mobile toggles -->
            <div class="me-auto pc-mob-drp">
                <ul class="list-unstyled">
                    <li class="pc-h-item header-mobile-collapse">
                        <a href="#" class="pc-head-link ms-0" id="sidebar-hide">
                            <i class="ti ti-menu-2"></i>
                        </a>
                    </li>
                    <li class="pc-h-item pc-sidebar-popup">
                        <a href="#" class="pc-head-link ms-0" id="mobile-collapse">
                            <i class="ti ti-menu-2"></i>
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Right side actions -->
            <div class="ms-auto">
                <ul class="list-unstyled d-flex align-items-center gap-2 mb-0">

                    <!-- Language switch -->
                    <li class="pc-h-item">
                        <a href="/Home/SetLanguage?culture=@(isArabic ? "en-US" : "ar-EG")&returnUrl=@Context.Request.Path"
                           class="pc-head-link"
                           title="@(isArabic ? "Switch to English" : "التغيير للعربية")"
                           style="font-size:13px; font-weight:700; width:auto; padding:0 12px; border-radius:8px; border:1.5px solid var(--el-border); color:var(--el-text-muted);">
                            @(isArabic ? "EN" : "عربي")
                        </a>
                    </li>

                    <!-- User profile -->
                    <li class="dropdown pc-h-item header-user-profile">
                        <a class="pc-head-link dropdown-toggle arrow-none me-0 d-flex align-items-center gap-2"
                           data-bs-toggle="dropdown" href="#" role="button" style="width:auto; padding:4px 8px;">
                            <img src="@(!string.IsNullOrEmpty(userImage) ? Url.Content("~/images/users/" + userImage) : $"https://ui-avatars.com/api/?name={Uri.EscapeDataString(displayName ?? "I")}&background=7C3AED&color=ffffff&size=128")"
                                 alt="avatar"
                                 class="user-avtar"
                                 style="width:36px; height:36px; border-radius:50%; object-fit:cover;" />
                        </a>

                        <div class="dropdown-menu dropdown-menu-end pc-h-dropdown" style="min-width:220px;">
                            <div class="px-3 py-3" style="background:var(--el-body); border-radius:10px; margin-bottom:6px;">
                                <p class="fw-bold mb-0" style="font-size:14px; color:var(--el-text);">@displayName</p>
                                <p class="mb-0" style="font-size:12px; color:var(--el-text-muted);">
                                    @(isArabic ? "لوحة تحكم المحاضر" : "Instructor Dashboard")
                                </p>
                            </div>
                            <a asp-area="Identity" asp-controller="MyProfile" asp-action="MyProfile" class="dropdown-item">
                                <i class="ti ti-settings"></i>
                                <span>@(isArabic ? "إعدادات الحساب" : "Account Settings")</span>
                            </a>
                            <div style="border-top:1px solid var(--el-border); margin:6px 0;"></div>
                            <a asp-action="Logout" asp-controller="Account" asp-area="Identity" class="dropdown-item" style="color:var(--el-danger)!important;">
                                <i class="ti ti-logout" style="color:var(--el-danger);"></i>
                                <span>@(isArabic ? "تسجيل الخروج" : "Logout")</span>
                            </a>
                        </div>
                    </li>

                </ul>
            </div>
        </div>
    </header>

    <!-- ─── Main Content ─────────────────────────────────── -->
    <div class="pc-container">
        <div class="pc-content">
            @RenderBody()
        </div>
    </div>

    <!-- ─── Scripts ─────────────────────────────────────── -->
    <script src="~/assets/js/plugins/popper.min.js"></script>
    <script src="~/assets/js/plugins/simplebar.min.js"></script>
    <script src="~/assets/js/plugins/bootstrap.min.js"></script>
    <script src="~/assets/js/script.js"></script>
    <script src="~/assets/js/theme.js"></script>
    <script src="~/assets/js/plugins/feather.min.js"></script>
    <script src="~/assets/js/plugins/apexcharts.min.js"></script>
    <script src="~/assets/js/pages/dashboard-default.js"></script>
    <script src="/lib/jquery/dist/jquery.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <!-- Berry init -->
    <script>
        layout_change('light');
        font_change('Roboto');
        change_box_container('false');
        layout_caption_change('true');
        layout_rtl_change('@(isArabic ? "true" : "false")');
        preset_change('preset-1');
    </script>

    <!-- Toast -->
    <script>
        function showElToast(message, icon) {
            Swal.mixin({
                toast: true,
                position: '@(isArabic ? "top-start" : "top-end")',
                showConfirmButton: false,
                timer: 4000,
                timerProgressBar: true,
                didOpen: (t) => {
                    t.addEventListener('mouseenter', Swal.stopTimer);
                    t.addEventListener('mouseleave', Swal.resumeTimer);
                }
            }).fire({ icon, title: message });
        }

        $(document).ready(function () {
            var s = '@TempData["Success"]', e = '@TempData["Error"]';
            if (s && s !== '') showElToast(s, 'success');
            if (e && e !== '') showElToast(e, 'error');
        });
    </script>

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
